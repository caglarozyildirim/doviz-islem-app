<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Döviz İşlem Formu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-left, .header-right {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .field-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .field-label {
            background: #d0d0d0;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 13px;
            white-space: nowrap;
            min-width: 150px;
        }

        .field-value {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        .field-value:focus {
            outline: none;
            border-color: #667eea;
        }

        .field-value.readonly {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 13px;
        }

        .status-badge.aktif {
            background: #d1fae5;
            color: #047857;
        }

        .status-badge.pasif {
            background: #fee2e2;
            color: #b91c1c;
        }

        .autocomplete-container {
            position: relative;
            flex: 1;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
        }

        .autocomplete-list.active {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
        }

        .autocomplete-item:hover {
            background: #f8fafc;
        }

        .autocomplete-item.selected {
            background: #eff6ff;
            color: #667eea;
            font-weight: 600;
        }

        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            background: #333;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            margin: 20px 0 10px 0;
            font-size: 14px;
        }

        .table-container {
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f0f0f0;
            padding: 10px;
            text-align: left;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid #ccc;
        }

        td {
            padding: 8px;
            border: 1px solid #ccc;
        }

        td input, td select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        td input:focus, td select:focus {
            outline: none;
            border-color: #667eea;
        }

        .islem-tag-cell {
            display: flex;
            gap: 6px;
            padding: 4px;
        }

        .islem-tag {
            flex: 1;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.2s;
            text-align: center;
        }

        .islem-tag.alis {
            color: #059669;
        }

        .islem-tag.alis.active {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .islem-tag.satis {
            color: #dc2626;
        }

        .islem-tag.satis.active {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .currency-tag-cell {
            display: flex;
            gap: 4px;
            padding: 4px;
        }

        .currency-tag-small {
            padding: 4px 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 11px;
            transition: all 0.2s;
        }

        .currency-tag-small:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .currency-tag-small.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .btn-add {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: #059669;
        }

        .btn-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .btn-remove:hover {
            background: #dc2626;
        }

        .actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .total-summary {
            background: #f9fafb;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 6px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .total-row:last-child {
            margin-bottom: 0;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            padding-top: 8px;
            border-top: 2px solid #e0e0e0;
        }

        .calculated-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            margin: 15px 0;
        }

        .calculated-display .label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .calculated-display .amount {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-row">
            <div class="header-left">
                <div class="field-group">
                    <div class="field-label">Müşteri Temsilcisi</div>
                    <input type="text" class="field-value readonly" id="temsilci" value="Ümit AKYÜZ" readonly>
                </div>
                <div class="field-group">
                    <div class="field-label">İşlem Tarihi</div>
                    <input type="date" class="field-value" id="islemTarihi">
                </div>
            </div>
            <div class="header-right">
                <div class="field-group">
                    <div class="field-label">MÜŞTERİ DURUM</div>
                    <div class="field-value readonly" id="musteriDurum" style="background: #f0f0f0; display: flex; align-items: center;">
                        <span id="durumBadge">Müşteri seçiniz</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Info -->
        <div class="info-row">
            <div class="field-group">
                <div class="field-label">UNVAN</div>
                <div class="autocomplete-container">
                    <input type="text" class="field-value" id="unvan" placeholder="Müşteri aratın..." autocomplete="off" oninput="filterCustomers()" onfocus="showCustomerList()">
                    <div class="autocomplete-list" id="customerList"></div>
                </div>
            </div>
            <div class="field-group">
                <div class="field-label">VERGİ MUAFİYET</div>
                <select class="field-value" id="vergiMuafiyet">
                    <option value="YOK">Yok</option>
                    <option value="VAR">Var</option>
                </select>
            </div>
        </div>

        <!-- Transaction Section -->
        <div class="section-title">İŞLEM BİLGİLERİ</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 140px;">İşlem</th>
                        <th style="width: 100px;">Kodu</th>
                        <th style="width: 120px;">Miktar</th>
                        <th style="width: 80px;">BSMV</th>
                        <th style="width: 100px;">Fiyat (Kur)</th>
                        <th style="width: 100px;">Vergi</th>
                        <th style="width: 150px;">Tutar</th>
                        <th style="width: 80px;">Birim</th>
                        <th style="width: 120px;">Valör Tarihi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="islem-tag-cell">
                                <button type="button" class="islem-tag alis" onclick="selectIslemTuru('ALIŞ')">ALIŞ</button>
                                <button type="button" class="islem-tag satis" onclick="selectIslemTuru('SATIŞ')">SATIŞ</button>
                            </div>
                            <input type="hidden" id="islemTuru" value="">
                        </td>
                        <td>
                            <div class="currency-tag-cell">
                                <button type="button" class="currency-tag-small" data-currency="TL" onclick="selectCurrency('TL')">TL</button>
                                <button type="button" class="currency-tag-small" data-currency="USD" onclick="selectCurrency('USD')">USD</button>
                                <button type="button" class="currency-tag-small" data-currency="EUR" onclick="selectCurrency('EUR')">EUR</button>
                                <button type="button" class="currency-tag-small" data-currency="GBP" onclick="selectCurrency('GBP')">GBP</button>
                            </div>
                            <input type="hidden" id="kodu" value="">
                        </td>
                        <td>
                            <input type="number" id="miktar" step="0.01" placeholder="0.00" oninput="updateCalculation()">
                        </td>
                        <td>
                            <input type="text" id="bsmv" readonly style="background: #f0f0f0; text-align: center;" value="YOK">
                        </td>
                        <td>
                            <input type="number" id="fiyat" step="0.0001" placeholder="0.0000" oninput="updateCalculation()">
                        </td>
                        <td>
                            <input type="number" id="vergi" readonly step="0.01" placeholder="0.00" value="0.00" style="background: #f0f0f0;">
                        </td>
                        <td>
                            <input type="text" id="tutar" readonly style="background: #f0f0f0; font-weight: bold;">
                        </td>
                        <td>
                            <input type="text" id="birim" value="TL">
                        </td>
                        <td>
                            <input type="date" id="valorTarihi">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Calculated Total Display -->
        <div class="calculated-display">
            <div class="label">TOPLAM TUTAR</div>
            <div class="amount" id="toplamTutar">0,00 TL</div>
        </div>

        <!-- Payment Banks Section -->
        <div class="section-title">ÖDEME BANKALARI (Çoklu Hesap)</div>
        <div class="table-container">
            <table id="paymentBanksTable">
                <thead>
                    <tr>
                        <th style="width: 350px;">Ödeme Banka - IBAN</th>
                        <th style="width: 100px;">Kodu</th>
                        <th style="width: 150px;">Miktar</th>
                        <th style="width: 80px;">İşlem</th>
                    </tr>
                </thead>
                <tbody id="paymentBanksBody">
                    <tr>
                        <td>
                            <select class="payment-bank" onchange="updatePaymentCurrency(this)">
                                <option value="">Banka Seçiniz...</option>
                                <option value="Denizbank - TR33 0012 3456 7890 1234 5678 90">Denizbank - TR33 0012 3456 7890 1234 5678 90</option>
                                <option value="İşbankası - TR44 0006 4000 0011 2345 6789 01">İşbankası - TR44 0006 4000 0011 2345 6789 01</option>
                                <option value="Garanti BBVA - TR55 0006 2000 0550 0006 2958 47">Garanti BBVA - TR55 0006 2000 0550 0006 2958 47</option>
                                <option value="Yapı Kredi - TR76 0006 7010 0000 0012 3456 78">Yapı Kredi - TR76 0006 7010 0000 0012 3456 78</option>
                                <option value="Akbank - TR98 0004 6006 0888 8000 1234 56">Akbank - TR98 0004 6006 0888 8000 1234 56</option>
                                <option value="QNB Finansbank - TR12 0011 1000 0000 0123 4567 89">QNB Finansbank - TR12 0011 1000 0000 0123 4567 89</option>
                                <option value="Ziraat Bankası - TR44 0001 0001 7845 6789 3050 01">Ziraat Bankası - TR44 0001 0001 7845 6789 3050 01</option>
                                <option value="Halkbank - TR66 0001 2009 4520 0016 0000 01">Halkbank - TR66 0001 2009 4520 0016 0000 01</option>
                                <option value="Vakıfbank - TR88 0001 5001 5800 7289 1234 56">Vakıfbank - TR88 0001 5001 5800 7289 1234 56</option>
                            </select>
                        </td>
                        <td>
                            <select class="payment-currency">
                                <option value="TL">TL</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" class="payment-amount" step="0.01" placeholder="0.00" oninput="calculatePaymentTotal()">
                        </td>
                        <td style="text-align: center;">
                            <button type="button" class="btn-remove" onclick="removePaymentRow(this)">Sil</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="btn-add" onclick="addPaymentRow()">+ Ödeme Hesabı Ekle</button>
        </div>

        <!-- Payment Summary -->
        <div class="total-summary">
            <div class="total-row">
                <span>İşlem Tutarı:</span>
                <span id="islemTutari">0,00 TL</span>
            </div>
            <div class="total-row">
                <span>Ödeme Toplamı:</span>
                <span id="odemeToplami">0,00 TL</span>
            </div>
            <div class="total-row">
                <span>KALAN:</span>
                <span id="kalanTutar">0,00 TL</span>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button type="button" class="btn btn-secondary" onclick="clearForm()">Temizle</button>
            <button type="button" class="btn btn-primary" onclick="saveTransaction()">Kaydet</button>
        </div>
    </div>

    <script>
        // Customer database with status and BSMV info
        const customers = [
            { name: 'Mehmet GÖR', status: 'Aktif', bsmv: 'YOK' },
            { name: 'Serkan Yüksel', status: 'Aktif', bsmv: 'VAR' },
            { name: 'Ahmet Demir', status: 'Pasif', bsmv: 'VAR' },
            { name: 'Ali Yılmaz', status: 'Aktif', bsmv: 'YOK' },
            { name: 'Ayşe Şahin', status: 'Aktif', bsmv: 'VAR' },
            { name: 'Fatma Çelik', status: 'Aktif', bsmv: 'YOK' },
            { name: 'Zeynep Arslan', status: 'Pasif', bsmv: 'VAR' },
            { name: 'Elif Öztürk', status: 'Aktif', bsmv: 'YOK' },
            { name: 'Mustafa Aydın', status: 'Aktif', bsmv: 'VAR' },
            { name: 'Hüseyin Koç', status: 'Aktif', bsmv: 'YOK' }
        ];

        let selectedCustomer = null;

        // Initialize dates
        document.getElementById('islemTarihi').valueAsDate = new Date();
        document.getElementById('valorTarihi').valueAsDate = new Date();

        // Customer autocomplete functions
        function showCustomerList() {
            filterCustomers();
        }

        function filterCustomers() {
            const searchValue = document.getElementById('unvan').value.toLowerCase();
            const customerList = document.getElementById('customerList');

            const filtered = customers.filter(c =>
                c.name.toLowerCase().includes(searchValue)
            );

            if (filtered.length === 0) {
                customerList.classList.remove('active');
                return;
            }

            customerList.innerHTML = filtered.map(customer => `
                <div class="autocomplete-item" onclick="selectCustomer('${customer.name}')">
                    ${customer.name}
                </div>
            `).join('');

            customerList.classList.add('active');
        }

        function selectCustomer(name) {
            const customer = customers.find(c => c.name === name);
            if (!customer) return;

            selectedCustomer = customer;
            document.getElementById('unvan').value = customer.name;

            // Update status badge
            const durumBadge = document.getElementById('durumBadge');
            durumBadge.className = 'status-badge ' + customer.status.toLowerCase();
            durumBadge.textContent = customer.status;

            // Update BSMV
            document.getElementById('bsmv').value = customer.bsmv;

            // Hide autocomplete
            document.getElementById('customerList').classList.remove('active');

            // Recalculate if there's data
            updateCalculation();
        }

        // Close autocomplete when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-container')) {
                document.getElementById('customerList').classList.remove('active');
            }
        });

        // Transaction type selection (tags)
        function selectIslemTuru(tur) {
            document.querySelectorAll('.islem-tag').forEach(tag => {
                tag.classList.remove('active');
            });

            if (tur === 'ALIŞ') {
                document.querySelector('.islem-tag.alis').classList.add('active');
            } else {
                document.querySelector('.islem-tag.satis').classList.add('active');
            }

            document.getElementById('islemTuru').value = tur;
        }

        // Currency selection
        function selectCurrency(currency) {
            document.querySelectorAll('.currency-tag-small').forEach(tag => {
                tag.classList.remove('active');
            });

            document.querySelector(`.currency-tag-small[data-currency="${currency}"]`).classList.add('active');
            document.getElementById('kodu').value = currency;

            updateCalculation();
        }

        // Update calculation with automatic tax (binde 2 if BSMV is VAR)
        function updateCalculation() {
            const kodu = document.getElementById('kodu').value;
            const miktar = parseFloat(document.getElementById('miktar').value) || 0;
            const fiyat = parseFloat(document.getElementById('fiyat').value) || 0;
            const bsmv = document.getElementById('bsmv').value;

            if (!kodu || miktar === 0 || fiyat === 0) {
                document.getElementById('vergi').value = '0.00';
                document.getElementById('tutar').value = '';
                document.getElementById('toplamTutar').textContent = '0,00 TL';
                document.getElementById('islemTutari').textContent = '0,00 TL';
                calculatePaymentTotal();
                return;
            }

            // Calculate base amount
            const baseAmount = miktar * fiyat;

            // Calculate tax (binde 2 = 0.002 if BSMV is VAR)
            let vergi = 0;
            if (bsmv === 'VAR') {
                vergi = baseAmount * 0.002; // %0.2 = binde 2
            }

            // Total
            const tutar = baseAmount + vergi;

            // Update displays
            document.getElementById('vergi').value = vergi.toFixed(2);
            const tutarFormatted = tutar.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('tutar').value = tutarFormatted + ' TL';
            document.getElementById('toplamTutar').textContent = tutarFormatted + ' TL';
            document.getElementById('islemTutari').textContent = tutarFormatted + ' TL';

            calculatePaymentTotal();
        }

        // Add payment row with remaining amount limit
        function addPaymentRow() {
            const kalanStr = document.getElementById('kalanTutar').textContent.replace(/[^\d,]/g, '').replace(',', '.');
            const kalan = parseFloat(kalanStr) || 0;

            if (kalan <= 0) {
                alert('Kalan tutar yok! Yeni ödeme kalemi eklenemez.');
                return;
            }

            const tbody = document.getElementById('paymentBanksBody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select class="payment-bank" onchange="updatePaymentCurrency(this)">
                        <option value="">Banka Seçiniz...</option>
                        <option value="Denizbank - TR33 0012 3456 7890 1234 5678 90">Denizbank - TR33 0012 3456 7890 1234 5678 90</option>
                        <option value="İşbankası - TR44 0006 4000 0011 2345 6789 01">İşbankası - TR44 0006 4000 0011 2345 6789 01</option>
                        <option value="Garanti BBVA - TR55 0006 2000 0550 0006 2958 47">Garanti BBVA - TR55 0006 2000 0550 0006 2958 47</option>
                        <option value="Yapı Kredi - TR76 0006 7010 0000 0012 3456 78">Yapı Kredi - TR76 0006 7010 0000 0012 3456 78</option>
                        <option value="Akbank - TR98 0004 6006 0888 8000 1234 56">Akbank - TR98 0004 6006 0888 8000 1234 56</option>
                        <option value="QNB Finansbank - TR12 0011 1000 0000 0123 4567 89">QNB Finansbank - TR12 0011 1000 0000 0123 4567 89</option>
                        <option value="Ziraat Bankası - TR44 0001 0001 7845 6789 3050 01">Ziraat Bankası - TR44 0001 0001 7845 6789 3050 01</option>
                        <option value="Halkbank - TR66 0001 2009 4520 0016 0000 01">Halkbank - TR66 0001 2009 4520 0016 0000 01</option>
                        <option value="Vakıfbank - TR88 0001 5001 5800 7289 1234 56">Vakıfbank - TR88 0001 5001 5800 7289 1234 56</option>
                    </select>
                </td>
                <td>
                    <select class="payment-currency">
                        <option value="TL">TL</option>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                    </select>
                </td>
                <td>
                    <input type="number" class="payment-amount" step="0.01" placeholder="0.00" max="${kalan.toFixed(2)}" oninput="limitPaymentAmount(this); calculatePaymentTotal()">
                </td>
                <td style="text-align: center;">
                    <button type="button" class="btn-remove" onclick="removePaymentRow(this)">Sil</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }

        // Limit payment amount to remaining total
        function limitPaymentAmount(input) {
            const kalanStr = document.getElementById('kalanTutar').textContent.replace(/[^\d,]/g, '').replace(',', '.');
            const kalan = parseFloat(kalanStr) || 0;
            const currentTotal = parseFloat(input.value) || 0;

            // Get total of OTHER payment inputs
            let otherPaymentsTotal = 0;
            document.querySelectorAll('.payment-amount').forEach(other => {
                if (other !== input) {
                    otherPaymentsTotal += parseFloat(other.value) || 0;
                }
            });

            const islemTutariStr = document.getElementById('islemTutari').textContent.replace(/[^\d,]/g, '').replace(',', '.');
            const islemTutari = parseFloat(islemTutariStr) || 0;

            const maxAllowed = islemTutari - otherPaymentsTotal;

            if (currentTotal > maxAllowed) {
                input.value = maxAllowed.toFixed(2);
            }
        }

        // Update payment currency based on bank selection (optional feature)
        function updatePaymentCurrency(selectElement) {
            // You can add logic here if needed
        }

        // Remove payment row
        function removePaymentRow(btn) {
            const tbody = document.getElementById('paymentBanksBody');
            if (tbody.children.length > 1) {
                btn.closest('tr').remove();
                calculatePaymentTotal();
            } else {
                alert('En az bir ödeme hesabı bulunmalıdır!');
            }
        }

        // Calculate payment total
        function calculatePaymentTotal() {
            let total = 0;
            document.querySelectorAll('.payment-amount').forEach(input => {
                total += parseFloat(input.value) || 0;
            });

            const islemTutariStr = document.getElementById('islemTutari').textContent.replace(/[^\d,]/g, '').replace(',', '.');
            const islemTutari = parseFloat(islemTutariStr) || 0;

            const kalan = islemTutari - total;

            document.getElementById('odemeToplami').textContent = total.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' TL';
            document.getElementById('kalanTutar').textContent = kalan.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' TL';

            // Color code the remaining amount
            const kalanElement = document.getElementById('kalanTutar');
            if (kalan > 0.01) {
                kalanElement.style.color = '#ef4444'; // Red if remaining
            } else if (kalan < -0.01) {
                kalanElement.style.color = '#f59e0b'; // Orange if overpaid
            } else {
                kalanElement.style.color = '#10b981'; // Green if exact
            }
        }

        // Save transaction
        function saveTransaction() {
            const data = {
                temsilci: document.getElementById('temsilci').value,
                islemTarihi: document.getElementById('islemTarihi').value,
                musteri: selectedCustomer,
                vergiMuafiyet: document.getElementById('vergiMuafiyet').value,
                islem: {
                    tur: document.getElementById('islemTuru').value,
                    kodu: document.getElementById('kodu').value,
                    miktar: document.getElementById('miktar').value,
                    bsmv: document.getElementById('bsmv').value,
                    fiyat: document.getElementById('fiyat').value,
                    vergi: document.getElementById('vergi').value,
                    tutar: document.getElementById('tutar').value,
                    birim: document.getElementById('birim').value,
                    valorTarihi: document.getElementById('valorTarihi').value
                },
                odemeler: []
            };

            // Collect payment banks
            const rows = document.querySelectorAll('#paymentBanksBody tr');
            rows.forEach(row => {
                const banka = row.querySelector('.payment-bank').value;
                const kodu = row.querySelector('.payment-currency').value;
                const miktar = row.querySelector('.payment-amount').value;

                if (banka && miktar) {
                    data.odemeler.push({ banka, kodu, miktar });
                }
            });

            // Validation
            if (!selectedCustomer) {
                alert('Lütfen müşteri seçiniz!');
                return;
            }

            if (!data.islem.tur || !data.islem.kodu || !data.islem.miktar || !data.islem.fiyat) {
                alert('Lütfen işlem bilgilerini eksiksiz doldurunuz!');
                return;
            }

            if (data.odemeler.length === 0) {
                alert('Lütfen en az bir ödeme hesabı ekleyiniz!');
                return;
            }

            // Check if payment total matches transaction total
            const kalanStr = document.getElementById('kalanTutar').textContent.replace(/[^\d,-]/g, '').replace(',', '.');
            const kalan = parseFloat(kalanStr) || 0;

            if (Math.abs(kalan) > 0.01) {
                const confirmSave = confirm(`Ödeme toplamı işlem tutarıyla eşleşmiyor. Kalan: ${document.getElementById('kalanTutar').textContent}\n\nYine de kaydetmek istiyor musunuz?`);
                if (!confirmSave) return;
            }

            console.log('Transaction Data:', data);
            alert('İşlem başarıyla kaydedildi!');
        }

        // Clear form
        function clearForm() {
            if (!confirm('Formu temizlemek istediğinize emin misiniz?')) return;

            selectedCustomer = null;
            document.getElementById('unvan').value = '';
            document.getElementById('durumBadge').className = '';
            document.getElementById('durumBadge').textContent = 'Müşteri seçiniz';
            document.getElementById('vergiMuafiyet').value = 'YOK';
            document.getElementById('islemTuru').value = '';
            document.getElementById('kodu').value = '';
            document.getElementById('miktar').value = '';
            document.getElementById('bsmv').value = 'YOK';
            document.getElementById('fiyat').value = '';
            document.getElementById('vergi').value = '0.00';
            document.getElementById('tutar').value = '';
            document.getElementById('birim').value = 'TL';
            document.getElementById('valorTarihi').valueAsDate = new Date();

            // Clear tags
            document.querySelectorAll('.islem-tag').forEach(tag => tag.classList.remove('active'));
            document.querySelectorAll('.currency-tag-small').forEach(tag => tag.classList.remove('active'));

            // Reset payment banks
            const tbody = document.getElementById('paymentBanksBody');
            tbody.innerHTML = `
                <tr>
                    <td>
                        <select class="payment-bank" onchange="updatePaymentCurrency(this)">
                            <option value="">Banka Seçiniz...</option>
                            <option value="Denizbank - TR33 0012 3456 7890 1234 5678 90">Denizbank - TR33 0012 3456 7890 1234 5678 90</option>
                            <option value="İşbankası - TR44 0006 4000 0011 2345 6789 01">İşbankası - TR44 0006 4000 0011 2345 6789 01</option>
                            <option value="Garanti BBVA - TR55 0006 2000 0550 0006 2958 47">Garanti BBVA - TR55 0006 2000 0550 0006 2958 47</option>
                            <option value="Yapı Kredi - TR76 0006 7010 0000 0012 3456 78">Yapı Kredi - TR76 0006 7010 0000 0012 3456 78</option>
                            <option value="Akbank - TR98 0004 6006 0888 8000 1234 56">Akbank - TR98 0004 6006 0888 8000 1234 56</option>
                            <option value="QNB Finansbank - TR12 0011 1000 0000 0123 4567 89">QNB Finansbank - TR12 0011 1000 0000 0123 4567 89</option>
                            <option value="Ziraat Bankası - TR44 0001 0001 7845 6789 3050 01">Ziraat Bankası - TR44 0001 0001 7845 6789 3050 01</option>
                            <option value="Halkbank - TR66 0001 2009 4520 0016 0000 01">Halkbank - TR66 0001 2009 4520 0016 0000 01</option>
                            <option value="Vakıfbank - TR88 0001 5001 5800 7289 1234 56">Vakıfbank - TR88 0001 5001 5800 7289 1234 56</option>
                        </select>
                    </td>
                    <td>
                        <select class="payment-currency">
                            <option value="TL">TL</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                        </select>
                    </td>
                    <td>
                        <input type="number" class="payment-amount" step="0.01" placeholder="0.00" oninput="calculatePaymentTotal()">
                    </td>
                    <td style="text-align: center;">
                        <button type="button" class="btn-remove" onclick="removePaymentRow(this)">Sil</button>
                    </td>
                </tr>
            `;

            updateCalculation();
        }
    </script>
</body>
</html>