<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Döviz İşlem Formu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-left, .header-right {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .field-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .field-label {
            background: #d0d0d0;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 13px;
            white-space: nowrap;
            min-width: 150px;
        }

        .field-value {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        .field-value:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            background: #333;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            margin: 20px 0 10px 0;
            font-size: 14px;
        }

        .table-container {
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f0f0f0;
            padding: 10px;
            text-align: left;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid #ccc;
        }

        td {
            padding: 8px;
            border: 1px solid #ccc;
        }

        td input, td select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        td input:focus, td select:focus {
            outline: none;
            border-color: #667eea;
        }

        .currency-tag-cell {
            display: flex;
            gap: 4px;
            padding: 4px;
        }

        .currency-tag-small {
            padding: 4px 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 11px;
            transition: all 0.2s;
        }

        .currency-tag-small:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .currency-tag-small.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .btn-add {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: #059669;
        }

        .btn-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .btn-remove:hover {
            background: #dc2626;
        }

        .actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .total-summary {
            background: #f9fafb;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 6px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .total-row:last-child {
            margin-bottom: 0;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            padding-top: 8px;
            border-top: 2px solid #e0e0e0;
        }

        .calculated-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            margin: 15px 0;
        }

        .calculated-display .label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .calculated-display .amount {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-row">
            <div class="header-left">
                <div class="field-group">
                    <div class="field-label">Müşteri Temsilcisi</div>
                    <input type="text" class="field-value" id="temsilci" value="Ümit AKYÜZ" readonly>
                </div>
                <div class="field-group">
                    <div class="field-label">İşlem Tarihi</div>
                    <input type="date" class="field-value" id="islemTarihi">
                </div>
            </div>
            <div class="header-right">
                <div class="field-group">
                    <div class="field-label">MÜŞTERİ DURUM</div>
                    <input type="text" class="field-value" id="musteriDurum" placeholder="Müşteri durum bilgisi...">
                </div>
            </div>
        </div>

        <!-- Customer Info -->
        <div class="info-row">
            <div class="field-group">
                <div class="field-label">UNVAN</div>
                <input type="text" class="field-value" id="unvan" placeholder="Müşteri unvanı...">
            </div>
            <div class="field-group">
                <div class="field-label">VERGİ MUAFİYET</div>
                <select class="field-value" id="vergiMuafiyet">
                    <option value="YOK">Yok</option>
                    <option value="VAR">Var</option>
                </select>
            </div>
        </div>

        <!-- Transaction Section -->
        <div class="section-title">İŞLEM BİLGİLERİ</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 80px;">İşlem</th>
                        <th style="width: 100px;">Kodu</th>
                        <th style="width: 120px;">Miktar</th>
                        <th style="width: 80px;">BSMV</th>
                        <th style="width: 100px;">Fiyat (Kur)</th>
                        <th style="width: 100px;">Vergi</th>
                        <th style="width: 150px;">Tutar</th>
                        <th style="width: 80px;">Birim</th>
                        <th style="width: 120px;">Valör Tarihi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <select id="islemTuru" onchange="updateCalculation()">
                                <option value="">Seç</option>
                                <option value="ALIŞ">ALIŞ</option>
                                <option value="SATIŞ">SATIŞ</option>
                            </select>
                        </td>
                        <td>
                            <div class="currency-tag-cell">
                                <button type="button" class="currency-tag-small" data-currency="TL" onclick="selectCurrency('TL')">TL</button>
                                <button type="button" class="currency-tag-small" data-currency="USD" onclick="selectCurrency('USD')">USD</button>
                                <button type="button" class="currency-tag-small" data-currency="EUR" onclick="selectCurrency('EUR')">EUR</button>
                                <button type="button" class="currency-tag-small" data-currency="GBP" onclick="selectCurrency('GBP')">GBP</button>
                            </div>
                            <input type="hidden" id="kodu" value="">
                        </td>
                        <td>
                            <input type="number" id="miktar" step="0.01" placeholder="0.00" oninput="updateCalculation()">
                        </td>
                        <td>
                            <select id="bsmv">
                                <option value="YOK">YOK</option>
                                <option value="VAR">VAR</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" id="fiyat" step="0.0001" placeholder="0.0000" oninput="updateCalculation()">
                        </td>
                        <td>
                            <input type="number" id="vergi" step="0.01" placeholder="0.00" value="0.00">
                        </td>
                        <td>
                            <input type="text" id="tutar" readonly style="background: #f0f0f0; font-weight: bold;">
                        </td>
                        <td>
                            <input type="text" id="birim" placeholder="">
                        </td>
                        <td>
                            <input type="date" id="valorTarihi">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Calculated Total Display -->
        <div class="calculated-display">
            <div class="label">TOPLAM TUTAR</div>
            <div class="amount" id="toplamTutar">0,00 TL</div>
        </div>

        <!-- Payment Banks Section -->
        <div class="section-title">ÖDEME BANKALARI (Çoklu Hesap)</div>
        <div class="table-container">
            <table id="paymentBanksTable">
                <thead>
                    <tr>
                        <th style="width: 250px;">Ödeme Banka</th>
                        <th style="width: 100px;">Kodu</th>
                        <th style="width: 150px;">Miktar</th>
                        <th style="width: 80px;">İşlem</th>
                    </tr>
                </thead>
                <tbody id="paymentBanksBody">
                    <tr>
                        <td>
                            <select class="payment-bank">
                                <option value="">Banka Seçiniz...</option>
                                <option value="Denizbank">Denizbank</option>
                                <option value="İşbankası">İşbankası</option>
                                <option value="Garanti BBVA">Garanti BBVA</option>
                                <option value="Yapı Kredi">Yapı Kredi</option>
                                <option value="Akbank">Akbank</option>
                                <option value="QNB Finansbank">QNB Finansbank</option>
                                <option value="Ziraat Bankası">Ziraat Bankası</option>
                                <option value="Halkbank">Halkbank</option>
                                <option value="Vakıfbank">Vakıfbank</option>
                            </select>
                        </td>
                        <td>
                            <select class="payment-currency">
                                <option value="TL">TL</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" class="payment-amount" step="0.01" placeholder="0.00" oninput="calculatePaymentTotal()">
                        </td>
                        <td style="text-align: center;">
                            <button type="button" class="btn-remove" onclick="removePaymentRow(this)">Sil</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="btn-add" onclick="addPaymentRow()">+ Ödeme Hesabı Ekle</button>
        </div>

        <!-- Payment Summary -->
        <div class="total-summary">
            <div class="total-row">
                <span>İşlem Tutarı:</span>
                <span id="islemTutari">0,00 TL</span>
            </div>
            <div class="total-row">
                <span>Ödeme Toplamı:</span>
                <span id="odemeToplami">0,00 TL</span>
            </div>
            <div class="total-row">
                <span>KALAN:</span>
                <span id="kalanTutar">0,00 TL</span>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button type="button" class="btn btn-secondary" onclick="clearForm()">Temizle</button>
            <button type="button" class="btn btn-primary" onclick="saveTransaction()">Kaydet</button>
        </div>
    </div>

    <script>
        // Initialize dates
        document.getElementById('islemTarihi').valueAsDate = new Date();
        document.getElementById('valorTarihi').valueAsDate = new Date();

        // Currency selection
        function selectCurrency(currency) {
            // Remove active from all
            document.querySelectorAll('.currency-tag-small').forEach(tag => {
                tag.classList.remove('active');
            });

            // Add active to selected
            document.querySelector(`.currency-tag-small[data-currency="${currency}"]`).classList.add('active');

            // Set hidden input
            document.getElementById('kodu').value = currency;

            updateCalculation();
        }

        // Update calculation
        function updateCalculation() {
            const kodu = document.getElementById('kodu').value;
            const miktar = parseFloat(document.getElementById('miktar').value) || 0;
            const fiyat = parseFloat(document.getElementById('fiyat').value) || 0;
            const vergi = parseFloat(document.getElementById('vergi').value) || 0;

            if (!kodu || miktar === 0 || fiyat === 0) {
                document.getElementById('tutar').value = '';
                document.getElementById('toplamTutar').textContent = '0,00 TL';
                document.getElementById('islemTutari').textContent = '0,00 TL';
                calculatePaymentTotal();
                return;
            }

            // Calculate: Miktar × Fiyat + Vergi
            let tutar = (miktar * fiyat) + vergi;

            // Format and display
            const tutarFormatted = tutar.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('tutar').value = tutarFormatted + ' TL';
            document.getElementById('toplamTutar').textContent = tutarFormatted + ' TL';
            document.getElementById('islemTutari').textContent = tutarFormatted + ' TL';

            calculatePaymentTotal();
        }

        // Add payment row
        function addPaymentRow() {
            const tbody = document.getElementById('paymentBanksBody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select class="payment-bank">
                        <option value="">Banka Seçiniz...</option>
                        <option value="Denizbank">Denizbank</option>
                        <option value="İşbankası">İşbankası</option>
                        <option value="Garanti BBVA">Garanti BBVA</option>
                        <option value="Yapı Kredi">Yapı Kredi</option>
                        <option value="Akbank">Akbank</option>
                        <option value="QNB Finansbank">QNB Finansbank</option>
                        <option value="Ziraat Bankası">Ziraat Bankası</option>
                        <option value="Halkbank">Halkbank</option>
                        <option value="Vakıfbank">Vakıfbank</option>
                    </select>
                </td>
                <td>
                    <select class="payment-currency">
                        <option value="TL">TL</option>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                    </select>
                </td>
                <td>
                    <input type="number" class="payment-amount" step="0.01" placeholder="0.00" oninput="calculatePaymentTotal()">
                </td>
                <td style="text-align: center;">
                    <button type="button" class="btn-remove" onclick="removePaymentRow(this)">Sil</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }

        // Remove payment row
        function removePaymentRow(btn) {
            const tbody = document.getElementById('paymentBanksBody');
            if (tbody.children.length > 1) {
                btn.closest('tr').remove();
                calculatePaymentTotal();
            } else {
                alert('En az bir ödeme hesabı bulunmalıdır!');
            }
        }

        // Calculate payment total
        function calculatePaymentTotal() {
            let total = 0;
            document.querySelectorAll('.payment-amount').forEach(input => {
                total += parseFloat(input.value) || 0;
            });

            const islemTutariStr = document.getElementById('islemTutari').textContent.replace(/[^\d,]/g, '').replace(',', '.');
            const islemTutari = parseFloat(islemTutariStr) || 0;

            const kalan = islemTutari - total;

            document.getElementById('odemeToplami').textContent = total.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' TL';
            document.getElementById('kalanTutar').textContent = kalan.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' TL';

            // Color code the remaining amount
            const kalanElement = document.getElementById('kalanTutar');
            if (kalan > 0) {
                kalanElement.style.color = '#ef4444'; // Red if remaining
            } else if (kalan < 0) {
                kalanElement.style.color = '#f59e0b'; // Orange if overpaid
            } else {
                kalanElement.style.color = '#10b981'; // Green if exact
            }
        }

        // Save transaction
        function saveTransaction() {
            const data = {
                temsilci: document.getElementById('temsilci').value,
                islemTarihi: document.getElementById('islemTarihi').value,
                musteriDurum: document.getElementById('musteriDurum').value,
                unvan: document.getElementById('unvan').value,
                vergiMuafiyet: document.getElementById('vergiMuafiyet').value,
                islem: {
                    tur: document.getElementById('islemTuru').value,
                    kodu: document.getElementById('kodu').value,
                    miktar: document.getElementById('miktar').value,
                    bsmv: document.getElementById('bsmv').value,
                    fiyat: document.getElementById('fiyat').value,
                    vergi: document.getElementById('vergi').value,
                    tutar: document.getElementById('tutar').value,
                    birim: document.getElementById('birim').value,
                    valorTarihi: document.getElementById('valorTarihi').value
                },
                odemeler: []
            };

            // Collect payment banks
            const rows = document.querySelectorAll('#paymentBanksBody tr');
            rows.forEach(row => {
                const banka = row.querySelector('.payment-bank').value;
                const kodu = row.querySelector('.payment-currency').value;
                const miktar = row.querySelector('.payment-amount').value;

                if (banka && miktar) {
                    data.odemeler.push({ banka, kodu, miktar });
                }
            });

            // Validation
            if (!data.unvan) {
                alert('Lütfen müşteri unvanını giriniz!');
                return;
            }

            if (!data.islem.tur || !data.islem.kodu || !data.islem.miktar || !data.islem.fiyat) {
                alert('Lütfen işlem bilgilerini eksiksiz doldurunuz!');
                return;
            }

            if (data.odemeler.length === 0) {
                alert('Lütfen en az bir ödeme hesabı ekleyiniz!');
                return;
            }

            // Check if payment total matches transaction total
            const kalanStr = document.getElementById('kalanTutar').textContent.replace(/[^\d,-]/g, '').replace(',', '.');
            const kalan = parseFloat(kalanStr) || 0;

            if (Math.abs(kalan) > 0.01) {
                const confirm = window.confirm(`Ödeme toplamı işlem tutarıyla eşleşmiyor. Kalan: ${document.getElementById('kalanTutar').textContent}\n\nYine de kaydetmek istiyor musunuz?`);
                if (!confirm) return;
            }

            console.log('Transaction Data:', data);
            alert('İşlem başarıyla kaydedildi!');

            // In real app, send to backend
            // await fetch('/api/transactions', { method: 'POST', body: JSON.stringify(data) });
        }

        // Clear form
        function clearForm() {
            if (!confirm('Formu temizlemek istediğinize emin misiniz?')) return;

            document.getElementById('musteriDurum').value = '';
            document.getElementById('unvan').value = '';
            document.getElementById('vergiMuafiyet').value = 'YOK';
            document.getElementById('islemTuru').value = '';
            document.getElementById('kodu').value = '';
            document.getElementById('miktar').value = '';
            document.getElementById('bsmv').value = 'YOK';
            document.getElementById('fiyat').value = '';
            document.getElementById('vergi').value = '0.00';
            document.getElementById('tutar').value = '';
            document.getElementById('birim').value = '';
            document.getElementById('valorTarihi').valueAsDate = new Date();

            // Clear currency selection
            document.querySelectorAll('.currency-tag-small').forEach(tag => {
                tag.classList.remove('active');
            });

            // Reset payment banks to single row
            const tbody = document.getElementById('paymentBanksBody');
            tbody.innerHTML = `
                <tr>
                    <td>
                        <select class="payment-bank">
                            <option value="">Banka Seçiniz...</option>
                            <option value="Denizbank">Denizbank</option>
                            <option value="İşbankası">İşbankası</option>
                            <option value="Garanti BBVA">Garanti BBVA</option>
                            <option value="Yapı Kredi">Yapı Kredi</option>
                            <option value="Akbank">Akbank</option>
                            <option value="QNB Finansbank">QNB Finansbank</option>
                            <option value="Ziraat Bankası">Ziraat Bankası</option>
                            <option value="Halkbank">Halkbank</option>
                            <option value="Vakıfbank">Vakıfbank</option>
                        </select>
                    </td>
                    <td>
                        <select class="payment-currency">
                            <option value="TL">TL</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                        </select>
                    </td>
                    <td>
                        <input type="number" class="payment-amount" step="0.01" placeholder="0.00" oninput="calculatePaymentTotal()">
                    </td>
                    <td style="text-align: center;">
                        <button type="button" class="btn-remove" onclick="removePaymentRow(this)">Sil</button>
                    </td>
                </tr>
            `;

            updateCalculation();
        }
    </script>
</body>
</html>
